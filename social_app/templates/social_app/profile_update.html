{% extends 'social_app/base.html' %}
{% load crispy_forms_tags %}

{% block title %}Settings - SocialHub{% endblock %}

{% block content %}
<div style="max-width: 650px; margin: 0 auto;">

    <!-- Header -->
    <div class="stellar-card mb-6 text-center animate-fade-in">
        <h1 class="text-gradient mb-2" style="font-size: 2.5rem;">
            <ion-icon name="settings-outline" style="vertical-align: middle; margin-right: 12px;"></ion-icon>
            Profile Settings
        </h1>
        <p class="text-muted" style="font-size: 1.1rem;">Update your digital presence.</p>
    </div>

    <!-- Profile Update Form -->
    <div class="stellar-card animate-fade-in" style="animation-delay: 0.1s; padding: 2.5rem;">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Account Information Section -->
            <div class="mb-10">
                <div class="flex-center gap-3 mb-6"
                    style="justify-content: flex-start; border-bottom: 1px solid var(--glass-border); padding-bottom: 1rem;">
                    <ion-icon name="person" class="text-primary" style="font-size: 1.5rem;"></ion-icon>
                    <h3 class="text-main mb-0" style="font-size: 1.25rem;">Account Details</h3>
                </div>

                <div class="mb-4">
                    <label class="text-dim mb-2" style="display: block; font-size: 0.9rem;">Username</label>
                    <div class="stellar-input-group">
                        <input type="text" name="username" value="{{ user_form.username.value }}" class="stellar-input"
                            required>
                    </div>
                    {% if user_form.username.errors %}
                    <p class="text-accent mt-2" style="font-size: 0.8rem;">{{ user_form.username.errors.0 }}</p>
                    {% endif %}
                </div>

                <div class="mb-4">
                    <label class="text-dim mb-2" style="display: block; font-size: 0.9rem;">Email Address</label>
                    <div class="stellar-input-group">
                        <input type="email" name="email" value="{{ user_form.email.value }}" class="stellar-input"
                            required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;">
                    <div class="mb-4">
                        <label class="text-dim mb-2" style="display: block; font-size: 0.9rem;">First Name</label>
                        <div class="stellar-input-group">
                            <input type="text" name="first_name" value="{{ user_form.first_name.value|default:'' }}"
                                class="stellar-input">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="text-dim mb-2" style="display: block; font-size: 0.9rem;">Last Name</label>
                        <div class="stellar-input-group">
                            <input type="text" name="last_name" value="{{ user_form.last_name.value|default:'' }}"
                                class="stellar-input">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Information Section -->
            <div class="mb-10">
                <div class="flex-center gap-3 mb-6"
                    style="justify-content: flex-start; border-bottom: 1px solid var(--glass-border); padding-bottom: 1rem;">
                    <ion-icon name="sparkles" class="text-secondary" style="font-size: 1.5rem;"></ion-icon>
                    <h3 class="text-main mb-0" style="font-size: 1.25rem;">Public Identity</h3>
                </div>

                <!-- Avatar Upload -->
                <div class="mb-6">
                    <label class="text-dim mb-4" style="display: block; font-size: 0.9rem;">Profile Avatar</label>
                    <div class="flex-center gap-6" style="justify-content: flex-start;">
                        <div class="avatar-wrapper"
                            style="width: 100px; height: 100px; border: 4px solid var(--glass-border); position: relative;">
                            {% if user.profile.avatar %}
                            <img src="{{ user.profile.avatar.url }}" alt="Avatar" id="current-avatar" class="avatar">
                            {% else %}
                            <div class="avatar flex-center"
                                style="background: var(--primary); font-size: 2.5rem; color: white;">
                                {{ user.username|slice:":1"|upper }}
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <label class="btn btn-secondary btn-pill mb-2"
                                style="cursor: pointer; padding: 0.6rem 1.25rem;">
                                Change Photo
                                <input type="file" name="avatar" id="id_avatar" style="display: none;">
                            </label>
                            <p class="text-dim mb-0" style="font-size: 0.8rem;">JPG, PNG, GIF</p>
                        </div>
                    </div>
                </div>

                <!-- Bio -->
                <div class="mb-6">
                    <label class="text-dim mb-2" style="display: block; font-size: 0.9rem;">Bio</label>
                    <div class="stellar-input-group">
                        <textarea name="bio" class="stellar-input"
                            style="min-height: 120px; resize: vertical;">{{ profile_form.bio.value|default:'' }}</textarea>
                    </div>
                </div>

                <!-- Location and Website -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;" class="mb-6">
                    <div>
                        <label class="text-dim mb-2" style="display: block; font-size: 0.9rem;">Location</label>
                        <div class="stellar-input-group">
                            <input type="text" name="location" value="{{ profile_form.location.value|default:'' }}"
                                class="stellar-input" placeholder="City, Country">
                        </div>
                    </div>
                    <div>
                        <label class="text-dim mb-2" style="display: block; font-size: 0.9rem;">Website</label>
                        <div class="stellar-input-group">
                            <input type="url" name="website" value="{{ profile_form.website.value|default:'' }}"
                                class="stellar-input" placeholder="https://example.com">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex-center gap-4"
                style="justify-content: flex-end; padding-top: 1.5rem; border-top: 1px solid var(--glass-border);">
                <a href="{% url 'profile' user.username %}" class="btn-ghost"
                    style="padding: 0.85rem 1.75rem; border-radius: var(--radius-pill);">
                    Discard
                </a>
                <button type="submit" class="btn btn-primary btn-pill" style="padding: 0.85rem 2rem;">
                    <ion-icon name="checkmark-circle" style="font-size: 1.1rem;"></ion-icon>
                    <span style="margin-left: 8px;">Save Profile</span>
                </button>
            </div>
        </form>
    </div>

    <!-- Security Quick Links -->
    <div class="stellar-card mt-6 p-6 animate-fade-in" style="animation-delay: 0.2s;">
        <h4 class="text-main mb-4" style="font-size: 1.1rem;">Security & Privacy</h4>
        <div class="flex-center gap-3" style="justify-content: flex-start;">
            <a href="{% url 'password_change' %}" class="btn-outline btn-pill"
                style="padding: 0.6rem 1.2rem; font-size: 0.9rem;">
                <ion-icon name="key-outline" style="margin-right: 6px;"></ion-icon>
                Change Password
            </a>
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const avatarInput = document.getElementById('id_avatar');
        const avatarPreview = document.querySelector('#current-avatar');

        if (avatarInput && avatarPreview) {
            avatarInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        avatarPreview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    });
</script>
{% endblock %}